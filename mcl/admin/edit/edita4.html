<!DOCTYPE html>

<head>
	<meta charset="utf-8">
	<title>MCL Edit</title>
	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.596.0.min.js"></script>
	<script src="../../js/jquery-3.4.1.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script src="admin.js"></script>
	<link rel="stylesheet" href="../css/edit.css">
	<link rel="stylesheet" href="../css/common.css">
</head>

<body>
	<nav>
		<ul class="nav-bar">
			<li class="menu"><a href="../index.html">에피소드</a></li>
			<li class="menu"><a href="../listProduct.html">상품</a></li>
			<li class="menu"><a href="../listCaster.html">인플루언서</a></li>
			<li class="menu dropdown active"><a href="./edita1.html">EDIT</a>
				<div class="dropdown-content">
					<a href="./edita1.html">메인 배너</a>
					<a href="./edita2.html">라이브 미리보기</a>
					<a href="./edita3.html">추천 상품</a>
					<a href="./edita4.html">추천 에피소드</a>
					<a href="./edita7.html">화제의 스타</a>
				</div>
			</li>
			<li class="menu logout"><a href="login.html">LOGOUT</a></li>
		</ul>
	</nav>

	<button class="editsendbtn" onclick="save()">변경내용 적용하기</button>

	<h3>EDIT : 추천 에피소드</h3>
	<h4>진행중인 추천에피소드</h4>

	<div class="frame" style="display: flex; padding: 20px 0; justify-content: space-between; align-items: flex-start;">

		<main style="width:360px; background-color:black;">

			<div class="a4">
				<div class="episodes" bind="list:sel_epi">
					<div class="item_wrapper  template" style="display:none">
						<a bind="href:videourl">
							<div class="thumbnail ">
								<div class="mask"></div>
								<div class="centered"><img
										src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mM8de5HPQAICwMRMij0YwAAAABJRU5ErkJggg=="
										bind="img:thumbnail" alt=""></div>
								<div class="caption">
									<span class="profile"><img bind="img:profileurl"
											src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mM8de5HPQAICwMRMij0YwAAAABJRU5ErkJggg=="
											bind="img:casterpkey" alt=""></span>
									<div class="titlebox">
										<div class="title" bind="text:title">11월 05일</div>
										<div class="count"><span class="view" bind="text:viewcount">272,706</span><span
												class="like" bind="text:likecount">0</span></div>
									</div>
								</div>
							</div>
						</a>
						<a bind="href:product[0].producturl">
							<div class="information">
								<div class="title" bind="text:product[0].productname">[닥터플로라] 로즈꽃물 레드크림 로즈꽃물 레드크림로즈꽃물
									레드크림로즈꽃물 레드크림</div>
								<div class="price"><del bind="text:product[0].xprice:price">>145,000</del><span
										class="total" bind="text:product[0].price:price">>120,500원</span></div>
								<div class="flags"><img bind="img:product[0].productthumb"
										src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mM8de5HPQAICwMRMij0YwAAAABJRU5ErkJggg=="
										alt=""></div>
								<span class="icon"></span>
							</div>
						</a>
					</div>
	
					<div class="a5" style="display:none">
						<!-- products_sm -->
						<div class="titlebar">
							<h2>이 브랜드의 다른 상품</h2>
							<a href="javascript:void(0);" class="more">더보기</a>
						</div>
						<div class="products_sm">
							<div class="item_wrappe">
								<div class="thumbnai">
									<div class="mask"></div>
									<div class="centered"><img
											src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mM8de5HPQAICwMRMij0YwAAAABJRU5ErkJggg=="
											alt=""></div>
									<div class="caption">
										<span class="icon">
											<i class="far fa-star"></i>
											<!--찜(?)했을때--><i class="fas fa-star" style="display:none;"></i>
										</span>
									</div>
								</div>
								<div class="informatio">
									<div class="title">[닥터플로라] 로즈꽃물 레드크림</div>
									<div class="price"><del>145,000</del><span class="total">120,500원</span></div>
									<div class="flags" bind="ak:badge:doBadge">
										<span class="icon_flags free" style="display:none">무료배송</span><span
											class="icon_flags recommend" style="display:none">뷰콜추천</span><span
											class="icon_flags best" style="display:none">베스트</span>
									</div>
								</div>
							</div>
	
						</div>
	
					</div>
	
				</div>
			</div>
		</main>

		<div class="rightpad"  style="width: 860px; margin: 0;">
		<h4>추천에피소드 선택</h4>
		<panel class="panelclass" style="width: 860px;">
			<label>에피소드 번호</label><input id="pan_txt1" type="text" style="width:600px" onkeyup="admchangeN('url','#pan_txt1')"><br/>
		</panel>

		 <div class="howto">
			<ol>
				<li>추천 에피소드 입니다.</li>
				<li>이미지를 위아래로 드래그하여 순서를 변경할 수 있습니다.</li>
				<li><del>에피소드를 변경할 수 있습니다. (준비중)</del></li>
				<li>적용하기 버튼을 누르면 적용됩니다.</li>
			</ol>
		</div>

		</div>
	</div>
</body>

</html>



<script>
	var curEle = null;
	var a1 = ".a4";
	var livepreview = ".episodes";
	var editkind = "sel_epi";
	function select(ele) {

		curEle = ele;
		var panel = $("panel");


		var a = $("[admkey=" + "url" + "]", ele).attr("d");
		var txt2 = $("[admkey=" + "productname" + "]", ele).attr("d");
		var txt3 = $("[admkey=" + "xprice" + "]", ele).attr("d");
		var txt4 = $("[admkey=" + "price" + "]", ele).attr("d");
		var txt5 = $("[admkey=" + "name" + "]", ele).attr("d");

		var img = $("[admkey=" + "productthumb" + "]", ele).attr("d");


		$("img", panel).attr("src", img);
		$("#pan_txt1", panel).val(a);
		$("#pan_txt2", panel).val(txt2);
		$("#pan_txt3", panel).val(txt3);
		$("#pan_txt4", panel).val(txt4);
		$("#pan_txt5", panel).val(txt5);

	}

	function admchange(key, txt) {
		var val = $(txt).val();
		$("[admkey=" + key + "]", curEle).attr("d", val);
		$("[admkey=" + key + "]", curEle).text(val);

	}


	function admchangeN(key, txt) {
		var val = $(txt).val();
		$("[admkey=" + key + "]", curEle).attr("d", val);


	}

	function drawFirst(d) {

		wmap(d, $(a1));
		$(".item_wrapper.template").remove();
		$("a", $(a1)).attr("href", "javascript:void(0)");
		$(".item_wrapper", $(a1)).on("click", function () {
			select($(this));
			return false;

		});

		$(livepreview).sortable({
			revert: true
		});
		$("#draggable").draggable({
			connectToSortable: livepreview,
			helper: "clone",
			revert: "invalid"
		});

	}


	function save() {
		var a18 = $(".item_wrapper");

		var ret = new Array();
		for (var i = 0; i < a18.length; i++) {
			var keys = $("[admkey]", a18.get(i));
			var cobj = {};
			ret[ret.length] = cobj;
			for (var ii = 0; ii < keys.length; ii++) {
				var item = $(keys.get(ii));
				var key = item.attr("admkey");
				var val = item.attr("d")
				cobj[key] = val;
			}
		}
	var txt = JSON.stringify(ret); 
		$.ajax({
			url: "https://mcl2.mycollabolife.com/admin.php?c=edit&m=saveEdit",
			type: "POST",
			data: { "kind": editkind,"txt":txt },
			dataType: "jsonp",
			success: function(data) {
				var head = data.HEAD;
				var body = data.BODY;

				if (head.STATUS == "error") {
					this.errfn(data.HEAD,data.BODY);
				} else {
					alert(data.BODY);
				}
			}
		});

	}

	function startupload(e) {

		uploadFile(e.files, "test/edit/a1", function (d, l) {
			$("[admkey=productthumb]", curEle).attr("src", l).attr("d", l);
			$("img", $("panel")).attr("src", l);
		});
	}

	$.wcall({
		url: "https://mcl2.mycollabolife.com/api.php?m=videolist",
		type: "GET",
		data: { "pkey": "3" },
		ok: function (head, body) { drawFirst(body); }
	});


</script>
<script>
	var albumBucketName = "s3.mcl";
	var bucketRegion = "ap-northeast-2";

	AWS.config.region = 'ap-northeast-2'; // 리전
	AWS.config.credentials = new AWS.Credentials({
		accessKeyId: 'AKIAZO5VA5G3JGFTX5EA', secretAccessKey: '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'
	});

	var s3 = new AWS.S3({
		apiVersion: "2006-03-01",
		params: { Bucket: albumBucketName }
	});


	function uploadFile(files, filepath, uploaddone) {

		var donefn = uploaddone;

		if (!files.length) {
			return alert("파일선택.");
		}
		var file = files[0];
		var fileName = file.name;


		var upload = new AWS.S3.ManagedUpload({
			params: {
				Bucket: albumBucketName,
				Key: filepath + "/" + fileName,
				Body: file,
				ACL: "public-read"
			}
		});

		var promise = upload.promise();
		promise.then(
			function (data) {
				donefn(data.Key, data.Location)
			},
			function (err) {
				return alert("업로드 실패: ", err.message);
			}
		);


	}



</script>

</html>